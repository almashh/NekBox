<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Nek5000: navier8.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nek5000
   </div>
   <div id="projectbrief">SEM for Incompressible NS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">navier8.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="navier8_8F90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00004"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a51b2c2d951e069b7ffa9a395b2def117">    4</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a51b2c2d951e069b7ffa9a395b2def117">set_vert</a>(glo_num,ngv,nx,nel,vertex,ifcenter)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : i8</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : nid</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classinput.html">input</a><span class="keywordtype">, only</span> : if3d</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordtype">integer(i8)</span> :: glo_num(1),ngv</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keywordtype">integer</span> :: vertex(*),nx, nel</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keywordtype">logical</span> :: ifcenter</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="keywordtype">integer</span> :: nz</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keywordflow">if</span> (if3d) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      call <a class="code" href="navier8_8F90.html#a928aff746415692c89ffdfbaf08fd98d">setvert3d</a>(glo_num,ngv,nx,nel,vertex,ifcenter)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">!max        call setvert2d(glo_num,ngv,nx,nel,vertex,ifcenter)</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">!   Check for single-element periodicity &#39;p&#39; bc</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  nz = 1</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordflow">if</span> (if3d) nz = nx</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  call <a class="code" href="navier8_8F90.html#a0233bb24c5654d0cfdce5b4a72f6c61b">check_p_bc</a>(glo_num,nx,nx,nz,nel)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordflow">if</span>(nid == 0) <span class="keyword">write</span>(6,*) <span class="stringliteral">&#39;call usrsetvert&#39;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  call usrsetvert(glo_num,nel,nx,nx,nx)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordflow">if</span>(nid == 0) <span class="keyword">write</span>(6,<span class="stringliteral">&#39;(A,/)&#39;</span>) <span class="stringliteral">&#39; done :: usrsetvert&#39;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a51b2c2d951e069b7ffa9a395b2def117">set_vert</a></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a809b9aa647f2046d09131be2f6074ff6">   35</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a809b9aa647f2046d09131be2f6074ff6">set_up_h1_crs</a></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : dp, i8</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : nx1, ny1, nz1, nelv, ndim, nid</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : lx1, ly1, lz1, lelv</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classctimer.html">ctimer</a><span class="keywordtype">, only</span> : <a class="code" href="classctimer.html#abcecbc845c8ee72e13a19eaa30b80d77">dnekclock</a></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classdomain.html">domain</a><span class="keywordtype">, only</span> : nx_crs, nxyz_c, se_to_gcrs, lcr</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classgeom.html">geom</a><span class="keywordtype">, only</span> : ifvcor, ifbcor</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classinput.html">input</a><span class="keywordtype">, only</span> : if3d, ifldmhd, cbc</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classmesh.html">mesh</a><span class="keywordtype">, only</span> : vertex</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classparallel.html">parallel</a><span class="keywordtype">, only</span> : xxth, mp=&gt;<a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>, nekcomm</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">use </span><a class="code" href="clasststep.html">tstep</a><span class="keywordtype">, only</span> : ifield</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordtype">integer</span> :: gs_handle</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordtype">integer</span> :: null_space</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordtype">character(3)</span> :: cb</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordtype">real(DP)</span> :: cmlt(lcr,lelv),mask(lcr,lelv)</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: ia(:,:,:), ja(:,:,:)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">real(DP)</span> :: z</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordtype">real(DP)</span>, <span class="keywordtype">allocatable</span> :: a(:)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">real(DP)</span>, <span class="keywordtype">allocatable</span> :: h1(:), h2(:), w1(:), w2(:)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordtype">integer(i8)</span> :: ngv</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">real(DP)</span> :: t0</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordtype">integer</span> :: nxc, ncr, ntot, nzc, nfaces, ie, iface, nz, n</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keyword">allocate</span>(ia(lcr,lcr,lelv), ja(lcr,lcr,lelv))</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  t0 = <a class="code" href="classctimer.html#abcecbc845c8ee72e13a19eaa30b80d77">dnekclock</a>()</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">!     nxc is order of coarse grid space + 1, nxc=2, linear, 3=quad,etc.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">!     nxc=param(82)</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">!     if (nxc.gt.lxc) then</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">!        nxc=lxc</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">!        write(6,*) &#39;WARNING :: coarse grid space too large&#39;,nxc,lxc</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">!     endif</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">!     if (nxc.lt.2) nxc=2</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  nxc     = 2</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  nx_crs  = nxc</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span>(nid == 0) <span class="keyword">write</span>(6,*) <span class="stringliteral">&#39;setup h1 coarse grid, nx_crs=&#39;</span>, nx_crs</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  ncr     = nxc**ndim</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  nxyz_c  = ncr</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">!   Set SEM_to_GLOB</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  call <a class="code" href="navier8_8F90.html#a3c68a6cfc47f9c2602ab5029cae20ac8">get_vertex</a></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  call <a class="code" href="navier8_8F90.html#a51b2c2d951e069b7ffa9a395b2def117">set_vert</a>(se_to_gcrs,ngv,nxc,nelv,vertex, .true. )</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">!   Set mask</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  z=0</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  ntot=nelv*nxyz_c</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  nzc=1</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (if3d) nzc=nxc</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  mask = 1._dp</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  cmlt = 1._dp</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  nfaces=2*ndim</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!   ifield=1      !c? avo: set in set_overlap through &#39;TSTEP&#39;?</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">if</span> (ifield == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">do</span> ie=1,nelv</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          <span class="keywordflow">do</span> iface=1,nfaces</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;              cb=cbc(iface,ie,ifield)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;              <span class="keywordflow">if</span> (cb == <span class="stringliteral">&#39;O  &#39;</span>  .OR.  cb == <span class="stringliteral">&#39;ON &#39;</span>  .OR.  cb == <span class="stringliteral">&#39;MM &#39;</span>  .OR. &amp;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;              cb == <span class="stringliteral">&#39;mm &#39;</span>  .OR.  cb == <span class="stringliteral">&#39;ms &#39;</span>  .OR.  cb == <span class="stringliteral">&#39;MS &#39;</span>) &amp;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;              call <a class="code" href="connect1_8F90.html#a1c96db1fac78d436aaab41482ed01aca">facev</a>(mask,ie,iface,z,nxc,nxc,nzc) <span class="comment">! &#39;S* &#39; &amp; &#39;s* &#39; ?avo?</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">elseif</span> (ifield == ifldmhd) <span class="keywordflow">then</span>   <span class="comment">! no ifmhd ?avo?</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">do</span> ie=1,nelv</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;          <span class="keywordflow">do</span> iface=1,nfaces</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;              cb=cbc(iface,ie,ifield)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;              <span class="keywordflow">if</span> (cb == <span class="stringliteral">&#39;ndd&#39;</span>  .OR.  cb == <span class="stringliteral">&#39;dnd&#39;</span>  .OR.  cb == <span class="stringliteral">&#39;ddn&#39;</span>) &amp;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;              call <a class="code" href="connect1_8F90.html#a1c96db1fac78d436aaab41482ed01aca">facev</a>(mask,ie,iface,z,nxc,nxc,nzc)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">!   Set global index of dirichlet nodes to zero; xxt will ignore them</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  call <a class="code" href="gs_8c.html#ab06a9ecd097f6fcc2fff32089bc1451b">gs_setup</a>(gs_handle,se_to_gcrs,ntot,nekcomm,mp)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  call <a class="code" href="gs_8c.html#a90cfb7ef2f2d9757e53ada12321ec71b">gs_op</a>(gs_handle,mask,1,2,0)  <span class="comment">!  &quot;*&quot;</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  call <a class="code" href="gs_8c.html#a90cfb7ef2f2d9757e53ada12321ec71b">gs_op</a>(gs_handle,cmlt,1,1,0)  <span class="comment">!  &quot;+&quot;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  call <a class="code" href="gs_8c.html#a441b940f4ce8080f2158041ffd04d72a">gs_free</a>(gs_handle)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  call <a class="code" href="navier8_8F90.html#af3415ba89435a722d569fd62b444255e">set_jl_crs_mask</a>(ntot,mask,se_to_gcrs)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  cmlt = 1._dp / cmlt</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">!   Setup local SEM-based Neumann operators (for now, just full...)</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!    if (param(51).eq.1) then     ! old coarse grid</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!       nxyz1=nx1*ny1*nz1</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!       lda = 27*nxyz1*lelt</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!       ldw =  7*nxyz1*lelt</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!       call get_local_crs(a,lda,nxc,h1,h2,w,ldw)</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!    else</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!      NOTE: a(),h1,...,w2() must all be large enough</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  n = nx1*ny1*nz1*nelv</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keyword">allocate</span>(h1(nx1*ny1*nz1*nelv),h2(nx1*ny1*nz1*nelv))</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keyword">allocate</span>(a(27*lx1*ly1*lz1*lelv))</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keyword">allocate</span>(w1(lx1*ly1*lz1*lelv),w2(lx1*ly1*lz1*lelv))</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  h1=1._dp; h2 = 0._dp</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  call <a class="code" href="navier8_8F90.html#aaeec4769efda346366e7e561aa844c88">get_local_crs_galerkin</a>(a,ncr,nxc,h1,h2,w1,w2)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keyword">deallocate</span>(h1,h2,w1,w2)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!    endif</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  call <a class="code" href="navier8_8F90.html#ad2c33128de1c346b8ab975efc32f9e72">set_mat_ij</a>(ia,ja,ncr,nelv)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  null_space=0</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">if</span> (ifield == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keywordflow">if</span> (ifvcor)  null_space=1</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordflow">elseif</span> (ifield == ifldmhd) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">if</span> (ifbcor)  null_space=1</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  nz=ncr*ncr*nelv</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  call <a class="code" href="crs_8h.html#a75666e74c2395e76351148739489653c">crs_setup</a>(xxth(ifield),nekcomm,mp, ntot,se_to_gcrs, &amp;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  nz,ia,ja,a, null_space)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keyword">deallocate</span>(a)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">!   call crs_stats(xxth(ifield))</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  t0 = <a class="code" href="classctimer.html#abcecbc845c8ee72e13a19eaa30b80d77">dnekclock</a>()-t0</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">if</span> (nid == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keyword">write</span>(6,*) <span class="stringliteral">&#39;done :: setup h1 coarse grid &#39;</span>,t0, <span class="stringliteral">&#39; sec&#39;</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keyword">write</span>(6,*) <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a809b9aa647f2046d09131be2f6074ff6">set_up_h1_crs</a></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="navier8_8F90.html#af3415ba89435a722d569fd62b444255e">  170</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#af3415ba89435a722d569fd62b444255e">set_jl_crs_mask</a>(n, mask, se_to_gcrs)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : dp, i8</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">integer</span> :: n</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">real(DP)</span> :: mask(*)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">integer(i8)</span> :: se_to_gcrs(*)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span>(mask(i) &lt; 0.1) se_to_gcrs(i)=0</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#af3415ba89435a722d569fd62b444255e">set_jl_crs_mask</a></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="navier8_8F90.html#ad2c33128de1c346b8ab975efc32f9e72">  185</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#ad2c33128de1c346b8ab975efc32f9e72">set_mat_ij</a>(ia,ja,n,ne)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">integer</span> :: n,ne</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">integer</span> :: ia(n,n,ne), ja(n,n,ne)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">integer</span> :: i,j,ie</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">do</span> ie=1,ne</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">do</span> j=1,n</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;              ia(i,j,ie)=(ie-1)*n+i-1</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;              ja(i,j,ie)=(ie-1)*n+j-1</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#ad2c33128de1c346b8ab975efc32f9e72">set_mat_ij</a></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="navier8_8F90.html#adcc31cd78dd8ff5e821a590c916e4506">  204</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#adcc31cd78dd8ff5e821a590c916e4506">ituple_sort</a>(a,lda,n,key,nkey,ind,aa)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">integer</span> :: lda, n, nkey</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">integer</span> :: a(lda,n),aa(lda)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">integer</span> :: ind(*),key(nkey)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">logical</span> :: iftuple_ialtb</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">integer</span> :: j, L, ir, ii, i</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">dO</span> 10 j=1,n</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      ind(j)=j</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  10 <span class="keywordflow">END DO</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">if</span> (n &lt;= 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  l=n/2+1</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  ir=n</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  100 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">if</span> (l &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      l=l-1</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">!           aa  = a  (l)</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      aa = a(:,l)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      ii  = ind(l)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">!           aa =   a(ir)</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      aa = a(:,ir)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      ii = ind(ir)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">!           a(ir) =   a( 1)</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      a(:,ir) = a(:,1)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      ind(ir) = ind( 1)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      ir=ir-1</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">if</span> (ir == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="comment">!              a(1) = aa</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          a(:,1) = aa</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          ind(1) = ii</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  i=l</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  j=l+l</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  200 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span> (j &lt;= ir) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">if</span> (j &lt; ir) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keywordflow">if</span> (iftuple_ialtb(a(1,j),a(1,j+1),key,nkey)) j=j+1</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">if</span> (iftuple_ialtb(aa,a(1,j),key,nkey)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">!              a(i) = a(j)</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          a(:,i) = a(:,j)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          ind(i) = ind(j)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          i=j</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          j=j+j</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;          j=ir+1</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      goto 200</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">!       a(i) = aa</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  a(:,i) = aa</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  ind(i) = ii</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  goto 100</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#adcc31cd78dd8ff5e821a590c916e4506">ituple_sort</a></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">  267</a></span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">iftuple_ialtb</a>(a,b,key,nkey)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordtype">integer</span> :: nkey</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">integer</span> :: a(*),b(*)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordtype">integer</span> :: key(nkey)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">integer</span> :: i, k</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">do</span> i=1,nkey</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      k=key(i)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">if</span> (a(k) &lt; b(k)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          <a class="code" href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">iftuple_ialtb</a> = .true. </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">elseif</span> (a(k) &gt; b(k)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;          <a class="code" href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">iftuple_ialtb</a> = .false. </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <a class="code" href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">iftuple_ialtb</a> = .false. </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keyword">end function </span><a class="code" href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">iftuple_ialtb</a></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="navier8_8F90.html#aba4affb4dc377d9eae7e5f3fed44130c">  290</a></span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="navier8_8F90.html#aba4affb4dc377d9eae7e5f3fed44130c">iftuple_ianeb</a>(a,b,key,nkey)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">integer</span> :: nkey</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordtype">integer</span> :: a(*),b(*)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">integer</span> :: key(nkey)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordtype">integer</span> :: i, k</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">do</span> i=1,nkey</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      k=key(i)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordflow">if</span> (a(k) /= b(k)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <a class="code" href="navier8_8F90.html#aba4affb4dc377d9eae7e5f3fed44130c">iftuple_ianeb</a> = .true. </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <a class="code" href="navier8_8F90.html#aba4affb4dc377d9eae7e5f3fed44130c">iftuple_ianeb</a> = .false. </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keyword">end function </span><a class="code" href="navier8_8F90.html#aba4affb4dc377d9eae7e5f3fed44130c">iftuple_ianeb</a></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a5c307bcd1af1a0036e75f65db3d06e39">  313</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a5c307bcd1af1a0036e75f65db3d06e39">specmpn</a>(b,nb,a,na,ba,ab,if3d,w,ldw)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : dp</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: if3d</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nb, na, ldw</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordtype">real(DP)</span>, <span class="keywordtype">intent(out)</span> :: b(nb,nb,nb)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordtype">real(DP)</span>, <span class="keywordtype">intent(in)</span> :: a(na,na,na)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordtype">real(DP)</span>, <span class="keywordtype">intent(out)</span> :: w(ldw) !&gt;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordtype">integer</span> :: ltest, nab, nbb, k, l, iz</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordtype">real(DP)</span> :: ba, ab</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  ltest = na*nb</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span> (if3d) ltest = na*na*nb + nb*na*na</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (ldw &lt; ltest) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keyword">write</span>(6,*) <span class="stringliteral">&#39;ERROR specmp:&#39;</span>,ldw,ltest,if3d</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      call <a class="code" href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">if</span> (if3d) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      nab = na*nb</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      nbb = nb*nb</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      call <a class="code" href="mxm__wrapper_8F90.html#ab9ec2260a10061af6ce1c52f3c8a41da">mxm</a>(ba,nb,a,na,w,na*na)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      k=1</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      l=na*na*nb + 1</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">do</span> iz=1,na</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          call <a class="code" href="mxm__wrapper_8F90.html#ab9ec2260a10061af6ce1c52f3c8a41da">mxm</a>(w(k),nb,ab,na,w(l),nb)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          k=k+nab</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;          l=l+nbb</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      l=na*na*nb + 1</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      call <a class="code" href="mxm__wrapper_8F90.html#ab9ec2260a10061af6ce1c52f3c8a41da">mxm</a>(w(l),nbb,ab,na,b,nb)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      call <a class="code" href="mxm__wrapper_8F90.html#ab9ec2260a10061af6ce1c52f3c8a41da">mxm</a>(ba,nb,a,na,w,na)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      call <a class="code" href="mxm__wrapper_8F90.html#ab9ec2260a10061af6ce1c52f3c8a41da">mxm</a>(w,nb,ab,na,b,nb)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a5c307bcd1af1a0036e75f65db3d06e39">specmpn</a></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a05f99aec875f63f8db64d774836f2902">  355</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a05f99aec875f63f8db64d774836f2902">irank</a>(A,IND,N)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">integer</span> :: A(*),IND(*), n</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordtype">integer</span> :: j, L, ir, i, q, indx</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">if</span> (n &lt;= 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">DO</span> 10 j=1,n</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      ind(j)=j</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  10 <span class="keywordflow">END DO</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (n == 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  l=n/2+1</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  ir=n</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  100 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">IF</span> (l &gt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      l=l-1</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      indx=ind(l)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      q=a(indx)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      indx=ind(ir)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      q=a(indx)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      ind(ir)=ind(1)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      ir=ir-1</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">if</span> (ir == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          ind(1)=indx</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">ENDIF</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  i=l</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  j=l+l</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  200 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">IF</span> (j &lt;= ir) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordflow">IF</span> (j &lt; ir) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <span class="keywordflow">IF</span> ( a(ind(j)) &lt; a(ind(j+1)) ) j=j+1</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">ENDIF</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">IF</span> (q &lt; a(ind(j))) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          ind(i)=ind(j)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          i=j</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          j=j+j</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          j=ir+1</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">ENDIF</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      goto 200</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">ENDIF</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  ind(i)=indx</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  goto 100</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a05f99aec875f63f8db64d774836f2902">irank</a></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00407"></a><span class="lineno"><a class="line" href="navier8_8F90.html#aaeec4769efda346366e7e561aa844c88">  407</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#aaeec4769efda346366e7e561aa844c88">get_local_crs_galerkin</a>(a,ncl,nxc,h1,h2,w1,w2)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : dp</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : nx1, ny1, nz1, nelv, lx1, ldim</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordtype">integer</span> :: ncl, nxc</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">real(DP)</span> ::    a(ncl,ncl,*),h1(*),h2(*)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">real(DP)</span> ::    w1(nx1*ny1*nz1,nelv),w2(nx1*ny1*nz1,nelv)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: lcrd=lx1**ldim</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">real(DP)</span> :: b(lcrd,8)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordtype">integer</span> :: e, i, j, isd, imsh, nxyz</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordtype">real(DP)</span>, <span class="keywordtype">external</span> :: ddot</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">do</span> j=1,ncl</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      call <a class="code" href="navier8_8F90.html#aae4a347bc7ce7b06fa7abf792db70953">gen_crs_basis</a>(b(1,j),j) <span class="comment">! bi- or tri-linear interpolant</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  isd  = 1</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  imsh = 1</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  nxyz = nx1*ny1*nz1</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">do</span> j = 1,ncl</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">do</span> e = 1,nelv</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(w1(1,e),b(1,j),nxyz)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      call <a class="code" href="hmholtz_8F90.html#aa576b5bd623cce50fd6323db12ba5376">axhelm</a>(w2,w1,h1,h2,imsh,isd)        <span class="comment">! A^e * bj</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">do</span> e = 1,nelv</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          <span class="keywordflow">do</span> i = 1,ncl</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;              a(i,j,e) = ddot(nxyz, b(:,i), 1, w2(:,e), 1)  <span class="comment">! bi^T * A^e * bj</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#aaeec4769efda346366e7e561aa844c88">get_local_crs_galerkin</a></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="navier8_8F90.html#aae4a347bc7ce7b06fa7abf792db70953">  449</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#aae4a347bc7ce7b06fa7abf792db70953">gen_crs_basis</a>(b,j) ! bi- tri-linear</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : dp</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : lx1, nx1, ny1, nz1, ndim</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classspeclib.html">speclib</a><span class="keywordtype">, only</span> : <a class="code" href="classspeclib.html#ab649647711dc444ca710b98bf943b0d8">zwgll</a></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordtype">real(DP)</span> :: b(nx1,ny1,nz1)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">integer</span> :: j</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordtype">real(DP)</span> :: z0(lx1),z1(lx1)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordtype">real(DP)</span> :: zr(lx1),zs(lx1),zt(lx1)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">integer</span> :: p,q,r</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  call <a class="code" href="classspeclib.html#ab649647711dc444ca710b98bf943b0d8">zwgll</a>(zr,zs,nx1)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">do</span> i=1,nx1</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      z0(i) = .5*(1-zr(i))  <span class="comment">! 1--&gt;0</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      z1(i) = .5*(1+zr(i))  <span class="comment">! 0--&gt;1</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(zr,z0,nx1)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(zs,z0,nx1)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(zt,z0,nx1)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (mod(j,2) == 0)                        call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(zr,z1,nx1)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">if</span> (j == 3 .OR. j == 4 .OR. j == 7 .OR. j == 8) call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(zs,z1,nx1)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span> (j &gt; 4)                               call <a class="code" href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a>(zt,z1,nx1)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span> (ndim == 3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">do</span> r=1,nx1</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          <span class="keywordflow">do</span> q=1,nx1</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;              <span class="keywordflow">do</span> p=1,nx1</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                  b(p,q,r) = zr(p)*zs(q)*zt(r)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">do</span> q=1,nx1</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          <span class="keywordflow">do</span> p=1,nx1</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;              b(p,q,1) = zr(p)*zs(q)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#aae4a347bc7ce7b06fa7abf792db70953">gen_crs_basis</a></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a3c68a6cfc47f9c2602ab5029cae20ac8">  499</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a3c68a6cfc47f9c2602ab5029cae20ac8">get_vertex</a></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classzper.html">zper</a><span class="keywordtype">, only</span> : ifgtp</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: icalld = 0</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">if</span> (icalld &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  icalld = 1</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">if</span> (ifgtp) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Oops: ifgtp&quot;</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">!max        call gen_gtp_vertex    (vertex, ncrnr)</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      call <a class="code" href="navier8_8F90.html#a3126acd6d2b7a3e63f6f0329d5bae424">get_vert</a></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a3c68a6cfc47f9c2602ab5029cae20ac8">get_vertex</a></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00519"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a8beadce5e829399452ec13a7ac6b4633">  519</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a8beadce5e829399452ec13a7ac6b4633">assign_gllnid</a>(gllnid,iunsort,nelgt,nelgv,np)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordtype">integer</span> :: gllnid(*),iunsort(*),nelgt,nelgv, np</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordtype">integer</span> :: eg</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">integer</span> :: nelgs, nnpstr, npstar, log2p, np2</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">external</span> :: log2</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordtype">integer</span> :: e, ip, k, nel, nmod, npp</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  log2p = log2(np)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  np2   = 2**log2p</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (np2 == np .AND. nelgv == nelgt) <span class="keywordflow">then</span>   <span class="comment">! std power of 2 case</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      npstar = maxval(gllnid(1:nelgt))+1</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      nnpstr = npstar/np</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="keywordflow">do</span> eg=1,nelgt</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;          gllnid(eg) = gllnid(eg)/nnpstr</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordflow">elseif</span> (np2 == np) <span class="keywordflow">then</span>   <span class="comment">! std power of 2 case, conjugate heat xfer</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">!        Assign fluid elements</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      npstar = max(np,maxval(gllnid(1:nelgv))+1)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      nnpstr = npstar/np</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordflow">do</span> eg=1,nelgv</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          gllnid(eg) = gllnid(eg)/nnpstr</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">!        Assign solid elements</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      nelgs  = nelgt-nelgv  <span class="comment">! number of solid elements</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      npstar = max(np,maxval(gllnid(nelgv+1:nelgv+nelgs))+1)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      nnpstr = npstar/np</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">do</span> eg=nelgv+1,nelgt</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;          gllnid(eg) = gllnid(eg)/nnpstr</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">elseif</span> (nelgv /= nelgt) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      call <a class="code" href="comm__mpi_8F90.html#a59fcf8a02fe54ab37f61050e3ca6b197">exitti</a> &amp;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      (<span class="stringliteral">&#39;Conjugate heat transfer requires P=power of 2.$&#39;</span>,np)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">!  Below is the code for P a non-power of two:</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">!  Split the sorted gllnid array (read from .map file)</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">!  into np contiguous partitions.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">!  To load balance the partitions in case of mod(nelgt,np)&gt;0</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">!  add 1 contiguous entry out of the sorted list to NODE_i</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">!  where i = np-mod(nelgt,np) ... np</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  nel   = nelgt/np       <span class="comment">! number of elements per processor</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  nmod  = mod(nelgt,np)  <span class="comment">! bounded between 1 ... np-1</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  npp   = np - nmod      <span class="comment">! how many paritions of size nel</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;     </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">! sort gllnid</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  call <a class="code" href="math_8F90.html#a2add00098b77e54191b10eb6711193f6">isort</a>(gllnid,iunsort,nelgt)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">! setup partitions of size nel</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  k   = 0</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">do</span> ip = 0,npp-1</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">do</span> e = 1,nel</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;          k = k + 1</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          gllnid(k) = ip</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">! setup partitions of size nel+1</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">if</span>(nmod &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">do</span> ip = npp,np-1</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          <span class="keywordflow">do</span> e = 1,nel+1</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;              k = k + 1</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;              gllnid(k) = ip</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">! unddo sorting to restore initial ordering by</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">! global element number</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  call <a class="code" href="math_8F90.html#a48aadfd4c5ae7f9588ead06b211b5fbc">iswapt_ip</a>(gllnid,iunsort,nelgt)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a8beadce5e829399452ec13a7ac6b4633">assign_gllnid</a></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a3126acd6d2b7a3e63f6f0329d5bae424">  607</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a3126acd6d2b7a3e63f6f0329d5bae424">get_vert</a></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : ndim</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classinput.html">input</a><span class="keywordtype">, only</span> : ifmoab</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classmesh.html">mesh</a><span class="keywordtype">, only</span> : vertex</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classparallel.html">parallel</a><span class="keywordtype">, only</span> : nelgt</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classzper.html">zper</a><span class="keywordtype">, only</span> : ifgfdm</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordtype">integer</span> :: ncrnr</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: icalld = 0</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">if</span> (icalld &gt; 0) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  icalld = 1</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  ncrnr = 2**ndim</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordflow">if</span> (ifmoab) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="preprocessor">#ifdef MOAB</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="preprocessor"></span>      call nekmoab_loadconn(vertex, nelgt, ncrnr)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      call <a class="code" href="navier8_8F90.html#a7b711f52527072521e8670492a58ed16">get_vert_map</a>(vertex, ncrnr, nelgt, <span class="stringliteral">&#39;.map&#39;</span>, ifgfdm)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a3126acd6d2b7a3e63f6f0329d5bae424">get_vert</a></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a7b711f52527072521e8670492a58ed16">  635</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a7b711f52527072521e8670492a58ed16">get_vert_map</a>(vertex, nlv, nel, suffix, ifgfdm)</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : lx1, ly1, lz1, lelv, nelt, nelv</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classinput.html">input</a><span class="keywordtype">, only</span> : reafle</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classparallel.html">parallel</a><span class="keywordtype">, only</span> : <a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>, <a class="code" href="classparallel.html#a07e279fd1cc6f4e9189bcaad37a0d3b6">gllnid</a>, <a class="code" href="classparallel.html#a9a8fe6b8e5cb33426f1ebc5d75ae256f">gllel</a>, <a class="code" href="classparallel.html#ac36680315d0622d84df5d5baf3fb0acc">lglel</a>, nelgt, nelgv</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classstring.html">string</a><span class="keywordtype">, only</span> : <a class="code" href="classstring.html#a788cdffdfd5841a6e4117c4b8e80da77">ltrunc</a></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classparallel.html">parallel</a><span class="keywordtype">, only</span> : nid, <a class="code" href="classparallel.html#a4ec9d2a0bf252d26709cff49bdf4b277">init_gllnid</a>, wdsize</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classmesh.html">mesh</a><span class="keywordtype">, only</span> : shape_x, <a class="code" href="classmesh.html#a383626b86a123c489b00681fcb13d503">ieg_to_xyz</a>, boundaries</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordtype">logical</span> :: ifgfdm</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordtype">integer</span> :: nlv, nel</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordtype">integer</span> :: vertex(nlv,*)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordtype">character(4)</span> :: suffix</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: mdw=2</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ndw=lx1*ly1*lz1*lelv/mdw</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keywordtype">integer</span> :: lshape(3)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keywordtype">integer</span> :: e,eg,eg0,eg1, ieg, iok, lfname, neli, nnzi, npass</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordtype">integer</span> :: ipass, m, ntuple, iflag, mid</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">external</span> :: iglmax, irecv</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordtype">integer</span> :: ix(3)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keywordtype">character(132)</span> :: mapfle</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordtype">character(1)</span> ::   mapfle1(132)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  equivalence(mapfle,mapfle1)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  iflag = 0</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  iok = 0</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">if</span> (nid == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      lfname = <a class="code" href="classstring.html#a788cdffdfd5841a6e4117c4b8e80da77">ltrunc</a>(reafle,132) - 4</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      call <a class="code" href="math_8F90.html#a692155d1d2ec380a9fdb2d81ef221625">blank</a>(mapfle,132)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      call <a class="code" href="math_8F90.html#ad7fb480cea001849621405f37167aab1">chcopy</a>(mapfle,reafle,lfname)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      call <a class="code" href="math_8F90.html#ad7fb480cea001849621405f37167aab1">chcopy</a>(mapfle1(lfname+1),suffix,4)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keyword">open</span>(unit=80,file=mapfle,status=<span class="stringliteral">&#39;old&#39;</span>,err=99)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keyword">read</span>(80,*,err=99) neli,nnzi,shape_x</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keyword">close</span>(80)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      iok = 1</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  99 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  iok = iglmax(iok,1)</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">if</span> (iok == 0) goto 999     <span class="comment">! Mapfile not found</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  call <a class="code" href="comm__mpi_8F90.html#ae425c1deb2e82d2007c97e1c4be990c8">bcast</a>(shape_x,3*wdsize)  </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  lshape = shape_x</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="keywordflow">if</span> (shape_x(1) &lt; 0) lshape(1) = -lshape(1) + 1</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordflow">if</span> (shape_x(2) &lt; 0) lshape(2) = -lshape(2) + 1</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">if</span> (shape_x(3) &lt; 0) lshape(3) = -lshape(3) + 1</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  shape_x = abs(shape_x)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordflow">if</span> (nid == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      neli = iglmax(neli,1)   <span class="comment">! communicate to all procs</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      neli = 0</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      neli = iglmax(neli,1)   <span class="comment">! communicate neli to all procs</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  npass = 1 + (neli/ndw)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keywordflow">if</span> (npass &gt; <a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">if</span> (nid == 0) <span class="keyword">write</span>(6,*) npass,<a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>,neli,ndw,<span class="stringliteral">&#39;Error get_vert_map&#39;</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      call <a class="code" href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  call <a class="code" href="classparallel.html#a4ec9d2a0bf252d26709cff49bdf4b277">init_gllnid</a>()</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  nelt = neli / <a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  nelv = neli / <a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a> &lt;= 64) <span class="keyword">write</span>(6,*) nid,nelv,nelt,nelgv,nelgt,<span class="stringliteral">&#39; NELV&#39;</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">!   NOW: crystal route vertex by processor id</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">do</span> e = 1, nelt</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    ieg = <a class="code" href="classparallel.html#ac36680315d0622d84df5d5baf3fb0acc">lglel</a>(e)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    ix = <a class="code" href="classmesh.html#a383626b86a123c489b00681fcb13d503">ieg_to_xyz</a>(ieg)</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    vertex(1,e) = 1 + mod(ix(1) + 0, lshape(1)) + mod(ix(2) + 0, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                + mod(ix(3) + 0, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    vertex(2,e) = 1 + mod(ix(1) + 1, lshape(1)) + mod(ix(2) + 0, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                + mod(ix(3) + 0, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    vertex(3,e) = 1 + mod(ix(1) + 0, lshape(1)) + mod(ix(2) + 1, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                + mod(ix(3) + 0, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    vertex(4,e) = 1 + mod(ix(1) + 1, lshape(1)) + mod(ix(2) + 1, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                + mod(ix(3) + 0, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    vertex(5,e) = 1 + mod(ix(1) + 0, lshape(1)) + mod(ix(2) + 0, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                + mod(ix(3) + 1, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    vertex(6,e) = 1 + mod(ix(1) + 1, lshape(1)) + mod(ix(2) + 0, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                + mod(ix(3) + 1, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    vertex(7,e) = 1 + mod(ix(1) + 0, lshape(1)) + mod(ix(2) + 1, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                + mod(ix(3) + 1, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    vertex(8,e) = 1 + mod(ix(1) + 1, lshape(1)) + mod(ix(2) + 1, lshape(2))*lshape(1) &amp;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                + mod(ix(3) + 1, lshape(3)) * lshape(1) * lshape(2)</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  iflag = iglmax(iflag,1)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">if</span> (iflag &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">do</span> mid=0,<a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>-1</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;          call <a class="code" href="comm__mpi_8F90.html#a4acb4d8e379294232e9219bec063d8f3">nekgsync</a></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          <span class="keywordflow">if</span> (mid == nid) &amp;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          <span class="keyword">write</span>(6,*) nid,ntuple,nelv,nelt,nelgt,<span class="stringliteral">&#39; NELT FB&#39;</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          call <a class="code" href="comm__mpi_8F90.html#a4acb4d8e379294232e9219bec063d8f3">nekgsync</a></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      call <a class="code" href="comm__mpi_8F90.html#a4acb4d8e379294232e9219bec063d8f3">nekgsync</a></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      call <a class="code" href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  999 <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordflow">if</span> (nid == 0) <span class="keyword">write</span>(6,*) <span class="stringliteral">&#39;ABORT: Could not find map file &#39;</span>,mapfle</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  call <a class="code" href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordflow">if</span> (nid == 0) <span class="keyword">write</span>(6,*)ipass,npass,eg0,eg1,mdw,m,eg,<span class="stringliteral">&#39;get v fail&#39;</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  call <a class="code" href="comm__mpi_8F90.html#a7c71e890279f4933a841a2d97c7de4bd">exitt0</a>  <span class="comment">! Emergency exit</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a7b711f52527072521e8670492a58ed16">get_vert_map</a></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00766"></a><span class="lineno"><a class="line" href="navier8_8F90.html#ab45afa33532528c978fbfcf44355bb28">  766</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#ab45afa33532528c978fbfcf44355bb28">irank_vecn</a>(ind,nn,a,m,n,key,nkey,aa)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordtype">integer</span> :: nn, m, n, nkey</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordtype">integer</span> :: ind(n),a(m,n)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordtype">integer</span> :: key(nkey),aa(m)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordtype">logical</span> :: iftuple_ianeb,a_ne_b</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordtype">integer</span> :: nk, i</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  nk = min(nkey,m)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  call <a class="code" href="navier8_8F90.html#adcc31cd78dd8ff5e821a590c916e4506">ituple_sort</a>(a,m,n,key,nk,ind,aa)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">!   Find unique a&#39;s</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  aa = a(:,1)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  nn     = 1</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  ind(1) = nn</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordflow">do</span> i=2,n</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      a_ne_b = iftuple_ianeb(aa,a(1,i),key,nk)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">if</span> (a_ne_b) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          aa = a(:,i)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          nn = nn+1</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      ind(i) = nn <span class="comment">! set ind() to rank</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#ab45afa33532528c978fbfcf44355bb28">irank_vecn</a></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00802"></a><span class="lineno"><a class="line" href="navier8_8F90.html#ad95667f017072090d261e5eaef823395">  802</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#ad95667f017072090d261e5eaef823395">gbtuple_rank</a>(tuple,m,n,nmax,cr_h,nid,np,ind)</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordtype">integer</span> :: m, n, nmax, nid, np</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordtype">integer</span> :: ind(nmax),tuple(m,nmax),cr_h</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: mmax=40</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordtype">integer</span> :: key(mmax),wtuple(mmax)</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordtype">integer</span> :: nk, i, k, nkey, ni, ky, nimx, nu, nu_tot, nu_prior</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">external</span> :: iglmax, igl_running_sum</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">if</span> (m &gt; mmax) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="keyword">write</span>(6,*) nid,m,mmax,<span class="stringliteral">&#39; gbtuple_rank fail&#39;</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      call <a class="code" href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">do</span> i=1,n</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      tuple(1,i) = mod(tuple(3,i),np) <span class="comment">! destination processor</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      tuple(2,i) = i                  <span class="comment">! return location</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  ni= n</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  ky=1  <span class="comment">! Assumes crystal_new already called</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  call crystal_ituple_transfer(cr_h, tuple,m,ni,nmax, ky)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  nimx = iglmax(ni,1)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordflow">if</span> (ni &gt; nmax)   <span class="keyword">write</span>(6,*) ni,nmax,n,<span class="stringliteral">&#39;cr_xfer problem, A&#39;</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordflow">if</span> (nimx &gt; nmax) call <a class="code" href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  nkey = m-2</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">do</span> k=1,nkey</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      key(k) = k+2</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  call <a class="code" href="navier8_8F90.html#ab45afa33532528c978fbfcf44355bb28">irank_vecn</a>(ind,nu,tuple,m,ni,key,nkey,wtuple)<span class="comment">! tuple re-ordered,</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">! but contents same</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  nu_tot   = igl_running_sum(nu) <span class="comment">! running sum over P processors</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  nu_prior = nu_tot - nu</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">do</span> i=1,ni</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      tuple(3,i) = ind(i) + nu_prior  <span class="comment">! global ranking</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  call crystal_ituple_transfer(cr_h, tuple,m,ni,nmax, ky)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  nk = 1  <span class="comment">! restore to original order, local rank: 2; global: 3</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  key(1) = 2</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  call <a class="code" href="navier8_8F90.html#adcc31cd78dd8ff5e821a590c916e4506">ituple_sort</a>(tuple,m,n,key,nk,ind,wtuple)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#ad95667f017072090d261e5eaef823395">gbtuple_rank</a></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00860"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a928aff746415692c89ffdfbaf08fd98d">  860</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a928aff746415692c89ffdfbaf08fd98d">setvert3d</a>(glo_num,ngv,nx,nel,vertex,ifcenter)</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : i8</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : lelt, ndim, nid, nelt</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classparallel.html">parallel</a><span class="keywordtype">, only</span> : cr_h, <a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>, nelgt, <a class="code" href="classparallel.html#ac36680315d0622d84df5d5baf3fb0acc">lglel</a></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classtopol.html">topol</a><span class="keywordtype">, only</span> : icface, skpdat</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordtype">integer(i8)</span> :: glo_num(*),ngv</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">integer</span> :: vertex(0:1,0:1,0:1,*),nx</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordtype">logical</span> :: ifcenter</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordtype">integer</span> ::  edge(0:1,0:1,0:1,3,lelt),enum(12,lelt),fnum(6,lelt)</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: nsafe=8   <span class="comment">! OFTEN, nsafe=2 suffices</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">integer</span> :: vertex_flat(8)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordtype">integer</span> :: etuple(4,12*lelt*nsafe)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordtype">integer</span> :: ftuple(5,6,lelt*nsafe)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="keywordtype">integer</span> :: ind(12*lelt*nsafe)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  equivalence(etuple,ftuple)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keywordtype">integer</span> :: gvf(4),facet(4),key(3),e</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordtype">logical</span> :: ifij</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">integer(i8)</span> :: igv,ig0</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordtype">integer(i8)</span> :: ngvv,ngve,ngvs,ngvi,ngvm</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">integer(i8)</span> :: n_on_edge,n_on_face,n_in_interior</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">integer(i8)</span> :: i8glmax</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordtype">integer</span> :: ny, nz, nxyz, nlv, nel, k, j, i, il, ile, kswap, m, n, nmax</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordtype">integer</span> :: n_unique_edges, iedg_loc, i0, i0e, nfaces, ncrnr, ifac, icrn</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordtype">integer</span> :: n_unique_faces, iface, i1, is, j0, j1, js, idir, jdir, it, jt</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordtype">integer</span> :: nxx, l</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">external</span> :: iglmax</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  ny   = nx</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  nz   = nx</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  nxyz = nx*ny*nz</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  key(1)=1</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  key(2)=2</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  key(3)=3</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  ngvs = -1</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">!   Assign hypercube ordering of vertices</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">!   -------------------------------------</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">!   Count number of unique vertices</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  nlv  = 2**ndim</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  ngvv = iglmax(vertex,nlv*nel)</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordflow">do</span> k=0,1</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;          <span class="keywordflow">do</span> j=0,1</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;              <span class="keywordflow">do</span> i=0,1</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;              <span class="comment">!           Local to global node number (vertex)</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                  il  = 1 + (nx-1)*i + nx*(nx-1)*j + nx*nx*(nx-1)*k</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                  ile = il + nx*ny*nz*(e-1)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                  glo_num(ile)   = vertex(i,j,k,e)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  ngv  = ngvv</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">if</span> (nx == 2) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">!   Assign global vertex numbers to SEM nodes on each edge</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">!   ------------------------------------------------------</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">!   Assign edge labels by bounding vertices.</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">do</span> k=0,1</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;          <span class="keywordflow">do</span> j=0,1</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;              <span class="keywordflow">do</span> i=0,1</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                  edge(i,j,k,1,e) = vertex(i,j,k,e)  <span class="comment">! r-edge</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                  edge(j,i,k,2,e) = vertex(i,j,k,e)  <span class="comment">! s-edge</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                  edge(k,i,j,3,e) = vertex(i,j,k,e)  <span class="comment">! t-edge</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">!   Sort edges by bounding vertices.</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">do</span> i = 1,3</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="keywordflow">do</span> k=0,1</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordflow">do</span> j=0,1</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;          <span class="keywordflow">if</span> (edge(0,j,k,i,e) &gt; edge(1,j,k,i,e)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;              kswap = edge(0,j,k,i,e)</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;              edge(0,j,k,i,e) = edge(1,j,k,i,e)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;              edge(1,j,k,i,e) = kswap</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;          etuple(3,1+j+k*2+(i-1)*4+12*(e-1)) = edge(0,j,k,i,e)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;          etuple(4,1+j+k*2+(i-1)*4+12*(e-1)) = edge(1,j,k,i,e)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">!   Assign a number (rank) to each unique edge</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  m    = 4</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  n    = 12*nel</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  nmax = 12*lelt*nsafe  <span class="comment">! nsafe for crystal router factor of safety</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  call <a class="code" href="navier8_8F90.html#ad95667f017072090d261e5eaef823395">gbtuple_rank</a>(etuple,m,n,nmax,cr_h,nid,<a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>,ind)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">do</span> i=1,nel</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordflow">do</span> j = 1,12</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      enum(j,i) = etuple(3,j+(i-1)*12)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  n_unique_edges = iglmax(enum,12*nel)</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  n_on_edge = nx-2</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  ngve      = n_unique_edges*n_on_edge</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      iedg_loc = 0</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="comment">!        Edges 1-4</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">do</span> k=0,1</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;          <span class="keywordflow">do</span> j=0,1</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;              igv = ngv + n_on_edge*(enum(iedg_loc+1,e)-1)</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;              i0  = nx*(nx-1)*j + nx*nx*(nx-1)*k</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;              i0e = i0 + nxyz*(e-1)</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;              <span class="keywordflow">if</span> (glo_num(i0e+1) &lt; glo_num(i0e+nx)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                  <span class="keywordflow">do</span> i=2,nx-1                                   <span class="comment">! std forward case</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                      glo_num(i0e+i) = igv + i-1</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                  <span class="keywordflow">do</span> i=2,nx-1                                   <span class="comment">! backward case</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                      glo_num(i0e+i) = igv + 1 + n_on_edge-(i-1)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;              <span class="keywordflow">endif</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;              iedg_loc = iedg_loc + 1</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">!        Edges 5-8</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">do</span> k=0,1</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          <span class="keywordflow">do</span> i=0,1</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;              igv = ngv + n_on_edge*(enum(iedg_loc+1,e)-1)</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;              i0  = 1+(nx-1)*i + nx*nx*(nx-1)*k</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;              i0e = i0 + nxyz*(e-1)</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;              <span class="keywordflow">if</span> (glo_num(i0e) &lt; glo_num(i0e+nx*(nx-1))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                  <span class="keywordflow">do</span> j=2,nx-1                                   <span class="comment">! std forward case</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                      glo_num(i0e+(j-1)*nx) = igv + j-1</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                  <span class="keywordflow">do</span> j=2,nx-1                                   <span class="comment">! backward case</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                      glo_num(i0e+(j-1)*nx) = igv + 1 + n_on_edge-(j-1)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;              <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;              iedg_loc = iedg_loc + 1</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="comment">!        Edges 9-12</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">do</span> j=0,1</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          <span class="keywordflow">do</span> i=0,1</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;              igv = ngv + n_on_edge*(enum(iedg_loc+1,e)-1)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;              i0  = 1 + (nx-1)*i + nx*(nx-1)*j</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;              i0e = i0 + nxyz*(e-1)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;              <span class="keywordflow">if</span> (glo_num(i0e) &lt; glo_num(i0e+nx*nx*(nx-1))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                  <span class="keywordflow">do</span> k=2,nx-1                                   <span class="comment">! std forward case</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                      glo_num(i0e+(k-1)*nx*nx) = igv + k-1</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                  <span class="keywordflow">do</span> k=2,nx-1                                   <span class="comment">! backward case</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                      glo_num(i0e+(k-1)*nx*nx) = igv + 1 + n_on_edge-(k-1)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;              <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;              iedg_loc = iedg_loc + 1</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  ngv   = ngv + ngve</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">!   Asign global node numbers on the interior of each face</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">!   ------------------------------------------------------</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">!   Assign faces by 3-tuples</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">!   (The following variables all take the symmetric</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">!   notation of IFACE as arguments:)</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">!   ICFACE(i,IFACE) -   Gives the 4 vertices which reside on face IFACE</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">!                       as depicted below, e.g. ICFACE(i,2)=2,4,6,8.</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">!                      3+-----+4    ^ Y</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">!                      /  2  /|     |</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">!   Edge 1 extends    /     / |     |</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">!     from vertex   7+-----+8 +2    +----&gt; X</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">!     1 to 2.        |  4  | /     /</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">!                    |     |/     /</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">!                   5+-----+6    Z</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">!                       3</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  nfaces=ndim*2</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  ncrnr =2**(ndim-1)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      vertex_flat = reshape(vertex(:,:,:,e), (/8/))</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">do</span> ifac=1,nfaces</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          <span class="keywordflow">do</span> icrn=1,ncrnr</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;              i                  = icface(icrn,ifac)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;              facet(icrn)        = vertex_flat(i)</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;          call <a class="code" href="math_8F90.html#a2add00098b77e54191b10eb6711193f6">isort</a>(facet,ind,ncrnr)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;          ftuple(3:1+ncrnr, ifac, e) = facet(1:ncrnr-1)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">!   Assign a number (rank) to each unique face</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  m    = 5</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  n    = 6*nel</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  nmax = 6*lelt*nsafe  <span class="comment">! nsafe for crystal router factor of safety</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  call <a class="code" href="navier8_8F90.html#ad95667f017072090d261e5eaef823395">gbtuple_rank</a>(ftuple,m,n,nmax,cr_h,nid,<a class="code" href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a>,ind)</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordflow">do</span> e = 1,nel</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">do</span> i=1,6</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      fnum(i,e) = ftuple(3,i,e)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  n_unique_faces = iglmax(fnum,6*nel)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  call <a class="code" href="connect1_8F90.html#aa6d2ebf2dfdfeae458d41ef4cb6d9fae">dsset</a>(nx,ny,nz)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">do</span> iface=1,nfaces</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          i0 = skpdat(1,iface)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;          i1 = skpdat(2,iface)</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;          is = skpdat(3,iface)</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;          j0 = skpdat(4,iface)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;          j1 = skpdat(5,iface)</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;          js = skpdat(6,iface)</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <span class="comment">!        On each face, count from minimum global vertex number,</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="comment">!        towards smallest adjacent vertex number.  e.g., suppose</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="comment">!        the face is defined by the following global vertex numbers:</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="comment">!                    11+--------+81</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="comment">!                      |c      d|</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <span class="comment">!                      |        |</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="comment">!                      |        |</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="comment">!                      |a      b|</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="comment">!                    15+--------+62</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="comment">!        We would count from c--&gt;a, then towards d.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;          gvf(1) = int(glo_num(i0+nx*(j0-1)+nxyz*(e-1)))</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;          gvf(2) = int(glo_num(i1+nx*(j0-1)+nxyz*(e-1)))</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          gvf(3) = int(glo_num(i0+nx*(j1-1)+nxyz*(e-1)))</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;          gvf(4) = int(glo_num(i1+nx*(j1-1)+nxyz*(e-1)))</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;          call <a class="code" href="navier8_8F90.html#a05f99aec875f63f8db64d774836f2902">irank</a>(gvf,ind,4)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="comment">!        ind(1) tells which element of gvf() is smallest.</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;          ifij = .false. </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;          <span class="keywordflow">if</span> (ind(1) == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;              idir =  1</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;              jdir =  1</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;              <span class="keywordflow">if</span> (gvf(2) &lt; gvf(3)) ifij = .true. </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          <span class="keywordflow">elseif</span> (ind(1) == 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;              idir = -1</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;              jdir =  1</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;              <span class="keywordflow">if</span> (gvf(1) &lt; gvf(4)) ifij = .true. </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;          <span class="keywordflow">elseif</span> (ind(1) == 3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;              idir =  1</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;              jdir = -1</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;              <span class="keywordflow">if</span> (gvf(4) &lt; gvf(1)) ifij = .true. </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;          <span class="keywordflow">elseif</span> (ind(1) == 4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;              idir = -1</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;              jdir = -1</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;              <span class="keywordflow">if</span> (gvf(3) &lt; gvf(2)) ifij = .true. </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            idir = 0</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            jdir = 0</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Wasn&#39;t supposed to get here!&quot;</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      </div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;          <span class="keywordflow">if</span> (idir &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;              it=i0</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;              i0=i1</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;              i1=it</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;              is=-is</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;          <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;          <span class="keywordflow">if</span> (jdir &lt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;              jt=j0</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;              j0=j1</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;              j1=jt</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;              js=-js</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;          <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;          nxx = nx*nx</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          n_on_face = (nx-2)*(ny-2)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;          ngvs  = n_unique_faces*n_on_face</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          ig0 = ngv + n_on_face*(fnum(iface,e)-1)</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          <span class="keywordflow">if</span> (ifij) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;              k=0</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;              l=0</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;              <span class="keywordflow">do</span> j=j0,j1,js</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                  <span class="keywordflow">do</span> i=i0,i1,is</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                      k=k+1</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                  <span class="comment">!              this is a serious kludge to stay on the face interior</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                      <span class="keywordflow">if</span> (k &gt; nx .AND. k &lt; nxx-nx .AND. &amp;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                      mod(k,nx) /= 1 .AND. mod(k,nx) /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                      <span class="comment">!                 interior</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                          l = l+1</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                          glo_num(i+nx*(j-1)+nxyz*(e-1)) = l + ig0</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;              k=0</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;              l=0</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;              <span class="keywordflow">do</span> i=i0,i1,is</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                  <span class="keywordflow">do</span> j=j0,j1,js</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                      k=k+1</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                  <span class="comment">!              this is a serious kludge to stay on the face interior</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                      <span class="keywordflow">if</span> (k &gt; nx .AND. k &lt; nxx-nx .AND. &amp;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                      mod(k,nx) /= 1 .AND. mod(k,nx) /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                      <span class="comment">!                 interior</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                          l = l+1</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                          glo_num(i+nx*(j-1)+nxyz*(e-1)) = l + ig0</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                      <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  ngv   = ngv + ngvs</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">!   Finally,  number interiors (only ifcenter=.true.)</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">!   -------------------------------------------------</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  n_in_interior = (nx-2)*(ny-2)*(nz-2)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  ngvi = n_in_interior*nelgt</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">if</span> (ifcenter) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;          ig0 = ngv + n_in_interior*(<a class="code" href="classparallel.html#ac36680315d0622d84df5d5baf3fb0acc">lglel</a>(e)-1)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          l = 0</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;          <span class="keywordflow">do</span> k=2,nz-1</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;              <span class="keywordflow">do</span> j=2,ny-1</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                  <span class="keywordflow">do</span> i=2,nx-1</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                      l = l+1</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                      glo_num(i+nx*(j-1)+nx*ny*(k-1)+nxyz*(e-1)) = ig0+l</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      ngv = ngv + ngvi</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="keywordflow">do</span> e=1,nel</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;          l = 0</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          <span class="keywordflow">do</span> k=2,nz-1</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;              <span class="keywordflow">do</span> j=2,ny-1</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                  <span class="keywordflow">do</span> i=2,nx-1</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                      l = l+1</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                      glo_num(i+nx*(j-1)+nx*ny*(k-1)+nxyz*(e-1)) = 0</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;              <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;          <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">!   Quick check on maximum #dofs:</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  m    = nxyz*nelt</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  ngvm = i8glmax(glo_num,m)</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  ngvv = ngvv + ngve + ngvs  <span class="comment">! number of unique ids w/o interior</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  ngvi = ngvi + ngvv         <span class="comment">! total number of unique ids</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="keywordflow">if</span> (nid == 0) <span class="keyword">write</span>(6,1) nx,ngvv,ngvi,ngv,ngvm</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  1 <span class="keyword">format</span>(<span class="stringliteral">&#39;   setvert3d:&#39;</span>,i4,4i12)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a928aff746415692c89ffdfbaf08fd98d">setvert3d</a></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="navier8_8F90.html#a0233bb24c5654d0cfdce5b4a72f6c61b"> 1237</a></span>&#160;<span class="keyword">subroutine </span><a class="code" href="navier8_8F90.html#a0233bb24c5654d0cfdce5b4a72f6c61b">check_p_bc</a>(glo_num,nx,ny,nz,nel)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classkinds.html">kinds</a><span class="keywordtype">, only</span> : i8</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordtype">use </span>size_m<span class="keywordtype">, only</span> : ndim, nelt</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordtype">use </span><a class="code" href="classinput.html">input</a><span class="keywordtype">, only</span> : ifflow, cbc</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">integer</span> :: nx, ny, nz, nel</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordtype">integer(i8)</span> :: glo_num(nx,ny,nz,nel)</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordtype">integer(i8)</span> :: gmn</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keywordtype">integer</span> :: e,f,fo,ef,efo, ifld, nface, k, j, i</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: eface0(6) = (/ 4,2,1,3,5,6 /)</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  ifld = 2</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">if</span> (ifflow) ifld = 1</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  nface=2*ndim</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordflow">do</span> e=1,nelt</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keywordflow">do</span> f=1,nface,2</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;          fo  = f+1</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          ef  = eface0(f)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          efo = eface0(fo)</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          <span class="keywordflow">if</span> (cbc(ef,e,ifld) == <span class="stringliteral">&#39;p  &#39;</span> .AND. cbc(efo,e,ifld) == <span class="stringliteral">&#39;p  &#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;              <span class="keywordflow">if</span> (f == 1) <span class="keywordflow">then</span>  <span class="comment">! r=-/+1</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                  <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                      <span class="keywordflow">do</span> j=1,ny</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                          gmn = min(glo_num(1,j,k,e),glo_num(nx,j,k,e))</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                          glo_num(1 ,j,k,e) = gmn</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                          glo_num(nx,j,k,e) = gmn</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;              <span class="keywordflow">elseif</span> (f == 3) <span class="keywordflow">then</span>  <span class="comment">! s=-/+1</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                  <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                      <span class="keywordflow">do</span> i=1,nx</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                          gmn = min(glo_num(i,1,k,e),glo_num(i,ny,k,e))</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                          glo_num(i,1 ,k,e) = gmn</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                          glo_num(i,ny,k,e) = gmn</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                  <span class="keywordflow">do</span> j=1,ny</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                      <span class="keywordflow">do</span> i=1,nx</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                          gmn = min(glo_num(i,j,1,e),glo_num(i,j,nz,e))</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                          glo_num(i,j,1 ,e) = gmn</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                          glo_num(i,j,nz,e) = gmn</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;              <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;          <span class="keywordflow">endif</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordflow">enddo</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="navier8_8F90.html#a0233bb24c5654d0cfdce5b4a72f6c61b">check_p_bc</a></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="ttc" id="classparallel_html_a9a8fe6b8e5cb33426f1ebc5d75ae256f"><div class="ttname"><a href="classparallel.html#a9a8fe6b8e5cb33426f1ebc5d75ae256f">parallel::gllel</a></div><div class="ttdeci">integer function gllel(ieg)</div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8F90_source.html#l00162">parallel_mod.F90:162</a></div></div>
<div class="ttc" id="navier8_8F90_html_a809b9aa647f2046d09131be2f6074ff6"><div class="ttname"><a href="navier8_8F90.html#a809b9aa647f2046d09131be2f6074ff6">set_up_h1_crs</a></div><div class="ttdeci">subroutine set_up_h1_crs</div><div class="ttdoc">? </div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00035">navier8.F90:35</a></div></div>
<div class="ttc" id="comm__mpi_8F90_html_ae425c1deb2e82d2007c97e1c4be990c8"><div class="ttname"><a href="comm__mpi_8F90.html#ae425c1deb2e82d2007c97e1c4be990c8">bcast</a></div><div class="ttdeci">subroutine bcast(buf, len)</div><div class="ttdef"><b>Definition:</b> <a href="comm__mpi_8F90_source.html#l00289">comm_mpi.F90:289</a></div></div>
<div class="ttc" id="navier8_8F90_html_af3415ba89435a722d569fd62b444255e"><div class="ttname"><a href="navier8_8F90.html#af3415ba89435a722d569fd62b444255e">set_jl_crs_mask</a></div><div class="ttdeci">subroutine set_jl_crs_mask(n, mask, se_to_gcrs)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00170">navier8.F90:170</a></div></div>
<div class="ttc" id="clasststep_html"><div class="ttname"><a href="clasststep.html">tstep</a></div><div class="ttdoc">cleaned </div><div class="ttdef"><b>Definition:</b> <a href="tstep__mod_8F90_source.html#l00002">tstep_mod.F90:2</a></div></div>
<div class="ttc" id="classinput_html"><div class="ttname"><a href="classinput.html">input</a></div><div class="ttdoc">Input parameters from preprocessors. </div><div class="ttdef"><b>Definition:</b> <a href="input__mod_8F90_source.html#l00011">input_mod.F90:11</a></div></div>
<div class="ttc" id="mxm__wrapper_8F90_html_ab9ec2260a10061af6ce1c52f3c8a41da"><div class="ttname"><a href="mxm__wrapper_8F90.html#ab9ec2260a10061af6ce1c52f3c8a41da">mxm</a></div><div class="ttdeci">subroutine mxm(a, n1, b, n2, c, n3)</div><div class="ttdoc">Compute matrix-matrix product C = A*B. </div><div class="ttdef"><b>Definition:</b> <a href="mxm__wrapper_8F90_source.html#l00007">mxm_wrapper.F90:7</a></div></div>
<div class="ttc" id="navier8_8F90_html_a7b711f52527072521e8670492a58ed16"><div class="ttname"><a href="navier8_8F90.html#a7b711f52527072521e8670492a58ed16">get_vert_map</a></div><div class="ttdeci">subroutine get_vert_map(vertex, nlv, nel, suffix, ifgfdm)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00635">navier8.F90:635</a></div></div>
<div class="ttc" id="connect1_8F90_html_aa6d2ebf2dfdfeae458d41ef4cb6d9fae"><div class="ttname"><a href="connect1_8F90.html#aa6d2ebf2dfdfeae458d41ef4cb6d9fae">dsset</a></div><div class="ttdeci">subroutine dsset(nx, ny, nz)</div><div class="ttdoc">Set up arrays IXCN,ESKIP,SKPDAT,NEDG,NOFFST for new NX,NY,NZ. </div><div class="ttdef"><b>Definition:</b> <a href="connect1_8F90_source.html#l00549">connect1.F90:549</a></div></div>
<div class="ttc" id="classctimer_html"><div class="ttname"><a href="classctimer.html">ctimer</a></div><div class="ttdef"><b>Definition:</b> <a href="ctimer__mod_8F90_source.html#l00001">ctimer_mod.F90:1</a></div></div>
<div class="ttc" id="hmholtz_8F90_html_aa576b5bd623cce50fd6323db12ba5376"><div class="ttname"><a href="hmholtz_8F90.html#aa576b5bd623cce50fd6323db12ba5376">axhelm</a></div><div class="ttdeci">subroutine axhelm(au, u, helm1, helm2, imesh, isd)</div><div class="ttdoc">Compute the (Helmholtz) matrix-vector product, AU = helm1*[A]u + helm2*[B]u, for NEL elements...</div><div class="ttdef"><b>Definition:</b> <a href="hmholtz_8F90_source.html#l00079">hmholtz.F90:79</a></div></div>
<div class="ttc" id="classtopol_html"><div class="ttname"><a href="classtopol.html">topol</a></div><div class="ttdoc">Arrays for direct stiffness summation. cleaned. </div><div class="ttdef"><b>Definition:</b> <a href="topol__mod_8F90_source.html#l00003">topol_mod.F90:3</a></div></div>
<div class="ttc" id="byte_8c_html_a2da8eeb074dfd3ffbfb3e9a4d301cda4"><div class="ttname"><a href="byte_8c.html#a2da8eeb074dfd3ffbfb3e9a4d301cda4">exitt</a></div><div class="ttdeci">void exitt()</div><div class="ttdef"><b>Definition:</b> <a href="comm__mpi_8F90_source.html#l00411">comm_mpi.F90:411</a></div></div>
<div class="ttc" id="gs_8c_html_ab06a9ecd097f6fcc2fff32089bc1451b"><div class="ttname"><a href="gs_8c.html#ab06a9ecd097f6fcc2fff32089bc1451b">gs_setup</a></div><div class="ttdeci">#define gs_setup</div><div class="ttdef"><b>Definition:</b> <a href="gs_8c_source.html#l00029">gs.c:29</a></div></div>
<div class="ttc" id="navier8_8F90_html_a3c68a6cfc47f9c2602ab5029cae20ac8"><div class="ttname"><a href="navier8_8F90.html#a3c68a6cfc47f9c2602ab5029cae20ac8">get_vertex</a></div><div class="ttdeci">subroutine get_vertex</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00499">navier8.F90:499</a></div></div>
<div class="ttc" id="classmesh_html_a383626b86a123c489b00681fcb13d503"><div class="ttname"><a href="classmesh.html#a383626b86a123c489b00681fcb13d503">mesh::ieg_to_xyz</a></div><div class="ttdeci">integer function, dimension(3) ieg_to_xyz(ieg)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__mod_8F90_source.html#l00032">mesh_mod.F90:32</a></div></div>
<div class="ttc" id="gs_8c_html_a441b940f4ce8080f2158041ffd04d72a"><div class="ttname"><a href="gs_8c.html#a441b940f4ce8080f2158041ffd04d72a">gs_free</a></div><div class="ttdeci">#define gs_free</div><div class="ttdef"><b>Definition:</b> <a href="gs_8c_source.html#l00030">gs.c:30</a></div></div>
<div class="ttc" id="classparallel_html_a4ec9d2a0bf252d26709cff49bdf4b277"><div class="ttname"><a href="classparallel.html#a4ec9d2a0bf252d26709cff49bdf4b277">parallel::init_gllnid</a></div><div class="ttdeci">subroutine init_gllnid()</div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8F90_source.html#l00047">parallel_mod.F90:47</a></div></div>
<div class="ttc" id="navier8_8F90_html_ad95667f017072090d261e5eaef823395"><div class="ttname"><a href="navier8_8F90.html#ad95667f017072090d261e5eaef823395">gbtuple_rank</a></div><div class="ttdeci">subroutine gbtuple_rank(tuple, m, n, nmax, cr_h, nid, np, ind)</div><div class="ttdoc">Return a unique rank for each matched tuple set. Global. Balanced. tuple is destroyed. By "balanced" we mean that none of the tuple entries is likely to be much more uniquely populated than any other, so that any of the tuples can serve as an initial (parallel) sort key First two slots in tuple(:,i) assumed empty. </div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00802">navier8.F90:802</a></div></div>
<div class="ttc" id="navier8_8F90_html_adcc31cd78dd8ff5e821a590c916e4506"><div class="ttname"><a href="navier8_8F90.html#adcc31cd78dd8ff5e821a590c916e4506">ituple_sort</a></div><div class="ttdeci">subroutine ituple_sort(a, lda, n, key, nkey, ind, aa)</div><div class="ttdoc">Use Heap Sort (p 231 Num. Rec., 1st Ed.) </div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00204">navier8.F90:204</a></div></div>
<div class="ttc" id="classdomain_html"><div class="ttname"><a href="classdomain.html">domain</a></div><div class="ttdef"><b>Definition:</b> <a href="domain__mod_8F90_source.html#l00001">domain_mod.F90:1</a></div></div>
<div class="ttc" id="classmesh_html"><div class="ttname"><a href="classmesh.html">mesh</a></div><div class="ttdoc">cleaned </div><div class="ttdef"><b>Definition:</b> <a href="mesh__mod_8F90_source.html#l00002">mesh_mod.F90:2</a></div></div>
<div class="ttc" id="classctimer_html_abcecbc845c8ee72e13a19eaa30b80d77"><div class="ttname"><a href="classctimer.html#abcecbc845c8ee72e13a19eaa30b80d77">ctimer::dnekclock</a></div><div class="ttdeci">real(dp) function dnekclock()</div><div class="ttdef"><b>Definition:</b> <a href="ctimer__mod_8F90_source.html#l00103">ctimer_mod.F90:103</a></div></div>
<div class="ttc" id="navier8_8F90_html_a3126acd6d2b7a3e63f6f0329d5bae424"><div class="ttname"><a href="navier8_8F90.html#a3126acd6d2b7a3e63f6f0329d5bae424">get_vert</a></div><div class="ttdeci">subroutine get_vert</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00607">navier8.F90:607</a></div></div>
<div class="ttc" id="classparallel_html_ac36680315d0622d84df5d5baf3fb0acc"><div class="ttname"><a href="classparallel.html#ac36680315d0622d84df5d5baf3fb0acc">parallel::lglel</a></div><div class="ttdeci">integer function lglel(iel)</div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8F90_source.html#l00176">parallel_mod.F90:176</a></div></div>
<div class="ttc" id="math_8F90_html_a3b43508554f14bdea8e14473d7d0803c"><div class="ttname"><a href="math_8F90.html#a3b43508554f14bdea8e14473d7d0803c">copy</a></div><div class="ttdeci">subroutine copy(a, b, n)</div><div class="ttdef"><b>Definition:</b> <a href="math_8F90_source.html#l00052">math.F90:52</a></div></div>
<div class="ttc" id="navier8_8F90_html_ab45afa33532528c978fbfcf44355bb28"><div class="ttname"><a href="navier8_8F90.html#ab45afa33532528c978fbfcf44355bb28">irank_vecn</a></div><div class="ttdeci">subroutine irank_vecn(ind, nn, a, m, n, key, nkey, aa)</div><div class="ttdoc">Compute rank of each unique entry a(1,i) Output: ind(i) i=1,...,n (global) rank of entry a(*...</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00766">navier8.F90:766</a></div></div>
<div class="ttc" id="classzper_html"><div class="ttname"><a href="classzper.html">zper</a></div><div class="ttdoc">Cleaned. </div><div class="ttdef"><b>Definition:</b> <a href="zper__mod_8F90_source.html#l00002">zper_mod.F90:2</a></div></div>
<div class="ttc" id="navier8_8F90_html_a8beadce5e829399452ec13a7ac6b4633"><div class="ttname"><a href="navier8_8F90.html#a8beadce5e829399452ec13a7ac6b4633">assign_gllnid</a></div><div class="ttdeci">subroutine assign_gllnid(gllnid, iunsort, nelgt, nelgv, np)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00519">navier8.F90:519</a></div></div>
<div class="ttc" id="classparallel_html_a07e279fd1cc6f4e9189bcaad37a0d3b6"><div class="ttname"><a href="classparallel.html#a07e279fd1cc6f4e9189bcaad37a0d3b6">parallel::gllnid</a></div><div class="ttdeci">integer function gllnid(ieg)</div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8F90_source.html#l00115">parallel_mod.F90:115</a></div></div>
<div class="ttc" id="navier8_8F90_html_a05f99aec875f63f8db64d774836f2902"><div class="ttname"><a href="navier8_8F90.html#a05f99aec875f63f8db64d774836f2902">irank</a></div><div class="ttdeci">subroutine irank(A, IND, N)</div><div class="ttdoc">Use Heap Sort (p 233 Num. Rec.), 5/26/93 pff. </div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00355">navier8.F90:355</a></div></div>
<div class="ttc" id="navier8_8F90_html_a5c307bcd1af1a0036e75f65db3d06e39"><div class="ttname"><a href="navier8_8F90.html#a5c307bcd1af1a0036e75f65db3d06e39">specmpn</a></div><div class="ttdeci">subroutine specmpn(b, nb, a, na, ba, ab, if3d, w, ldw)</div><div class="ttdoc">Spectral interpolation from A to B via tensor products. </div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00313">navier8.F90:313</a></div></div>
<div class="ttc" id="math_8F90_html_a2add00098b77e54191b10eb6711193f6"><div class="ttname"><a href="math_8F90.html#a2add00098b77e54191b10eb6711193f6">isort</a></div><div class="ttdeci">subroutine isort(a, ind, n)</div><div class="ttdoc">Use Heap Sort (p 231 Num. Rec., 1st Ed.) </div><div class="ttdef"><b>Definition:</b> <a href="math_8F90_source.html#l00421">math.F90:421</a></div></div>
<div class="ttc" id="navier8_8F90_html_a928aff746415692c89ffdfbaf08fd98d"><div class="ttname"><a href="navier8_8F90.html#a928aff746415692c89ffdfbaf08fd98d">setvert3d</a></div><div class="ttdeci">subroutine setvert3d(glo_num, ngv, nx, nel, vertex, ifcenter)</div><div class="ttdoc">setup unique ids for dssum. note: total number of unique vertices, edges and faces has to be smaller ...</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00860">navier8.F90:860</a></div></div>
<div class="ttc" id="classparallel_html"><div class="ttname"><a href="classparallel.html">parallel</a></div><div class="ttdoc">cleaned </div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8F90_source.html#l00002">parallel_mod.F90:2</a></div></div>
<div class="ttc" id="navier8_8F90_html_a51b2c2d951e069b7ffa9a395b2def117"><div class="ttname"><a href="navier8_8F90.html#a51b2c2d951e069b7ffa9a395b2def117">set_vert</a></div><div class="ttdeci">subroutine set_vert(glo_num, ngv, nx, nel, vertex, ifcenter)</div><div class="ttdoc">Given global array, vertex, pointing to hex vertices, set up a new array of global pointers for an nx...</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00004">navier8.F90:4</a></div></div>
<div class="ttc" id="math_8F90_html_a692155d1d2ec380a9fdb2d81ef221625"><div class="ttname"><a href="math_8F90.html#a692155d1d2ec380a9fdb2d81ef221625">blank</a></div><div class="ttdeci">subroutine blank(A, N)</div><div class="ttdoc">blank a string </div><div class="ttdef"><b>Definition:</b> <a href="math_8F90_source.html#l00038">math.F90:38</a></div></div>
<div class="ttc" id="comm__mpi_8F90_html_a7c71e890279f4933a841a2d97c7de4bd"><div class="ttname"><a href="comm__mpi_8F90.html#a7c71e890279f4933a841a2d97c7de4bd">exitt0</a></div><div class="ttdeci">subroutine exitt0</div><div class="ttdef"><b>Definition:</b> <a href="comm__mpi_8F90_source.html#l00390">comm_mpi.F90:390</a></div></div>
<div class="ttc" id="navier8_8F90_html_a6ebc28a6b47b98235b1eb9310a75b10b"><div class="ttname"><a href="navier8_8F90.html#a6ebc28a6b47b98235b1eb9310a75b10b">iftuple_ialtb</a></div><div class="ttdeci">logical function iftuple_ialtb(a, b, key, nkey)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00267">navier8.F90:267</a></div></div>
<div class="ttc" id="gs_8c_html_a90cfb7ef2f2d9757e53ada12321ec71b"><div class="ttname"><a href="gs_8c.html#a90cfb7ef2f2d9757e53ada12321ec71b">gs_op</a></div><div class="ttdeci">#define gs_op</div><div class="ttdef"><b>Definition:</b> <a href="gs_8c_source.html#l00015">gs.c:15</a></div></div>
<div class="ttc" id="comm__mpi_8F90_html_a4acb4d8e379294232e9219bec063d8f3"><div class="ttname"><a href="comm__mpi_8F90.html#a4acb4d8e379294232e9219bec063d8f3">nekgsync</a></div><div class="ttdeci">subroutine nekgsync()</div><div class="ttdef"><b>Definition:</b> <a href="comm__mpi_8F90_source.html#l00318">comm_mpi.F90:318</a></div></div>
<div class="ttc" id="classgeom_html"><div class="ttname"><a href="classgeom.html">geom</a></div><div class="ttdoc">Geometry arrays. </div><div class="ttdef"><b>Definition:</b> <a href="geom__mod_8F90_source.html#l00002">geom_mod.F90:2</a></div></div>
<div class="ttc" id="classspeclib_html_ab649647711dc444ca710b98bf943b0d8"><div class="ttname"><a href="classspeclib.html#ab649647711dc444ca710b98bf943b0d8">speclib::zwgll</a></div><div class="ttdeci">subroutine, public zwgll(Z, W, NP)</div><div class="ttdef"><b>Definition:</b> <a href="speclib_8F90_source.html#l00095">speclib.F90:95</a></div></div>
<div class="ttc" id="crs_8h_html_a75666e74c2395e76351148739489653c"><div class="ttname"><a href="crs_8h.html#a75666e74c2395e76351148739489653c">crs_setup</a></div><div class="ttdeci">#define crs_setup</div><div class="ttdef"><b>Definition:</b> <a href="crs_8h_source.html#l00008">crs.h:8</a></div></div>
<div class="ttc" id="classspeclib_html"><div class="ttname"><a href="classspeclib.html">speclib</a></div><div class="ttdef"><b>Definition:</b> <a href="speclib_8F90_source.html#l00067">speclib.F90:67</a></div></div>
<div class="ttc" id="navier8_8F90_html_a0233bb24c5654d0cfdce5b4a72f6c61b"><div class="ttname"><a href="navier8_8F90.html#a0233bb24c5654d0cfdce5b4a72f6c61b">check_p_bc</a></div><div class="ttdeci">subroutine check_p_bc(glo_num, nx, ny, nz, nel)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l01237">navier8.F90:1237</a></div></div>
<div class="ttc" id="math_8F90_html_ad7fb480cea001849621405f37167aab1"><div class="ttname"><a href="math_8F90.html#ad7fb480cea001849621405f37167aab1">chcopy</a></div><div class="ttdeci">subroutine chcopy(a, b, n)</div><div class="ttdef"><b>Definition:</b> <a href="math_8F90_source.html#l00063">math.F90:63</a></div></div>
<div class="ttc" id="classkinds_html"><div class="ttname"><a href="classkinds.html">kinds</a></div><div class="ttdef"><b>Definition:</b> <a href="kinds__mod_8F90_source.html#l00001">kinds_mod.F90:1</a></div></div>
<div class="ttc" id="math_8F90_html_a48aadfd4c5ae7f9588ead06b211b5fbc"><div class="ttname"><a href="math_8F90.html#a48aadfd4c5ae7f9588ead06b211b5fbc">iswapt_ip</a></div><div class="ttdeci">subroutine iswapt_ip(x, p, n)</div><div class="ttdef"><b>Definition:</b> <a href="math_8F90_source.html#l00570">math.F90:570</a></div></div>
<div class="ttc" id="navier8_8F90_html_ad2c33128de1c346b8ab975efc32f9e72"><div class="ttname"><a href="navier8_8F90.html#ad2c33128de1c346b8ab975efc32f9e72">set_mat_ij</a></div><div class="ttdeci">subroutine set_mat_ij(ia, ja, n, ne)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00185">navier8.F90:185</a></div></div>
<div class="ttc" id="classstring_html"><div class="ttname"><a href="classstring.html">string</a></div><div class="ttdef"><b>Definition:</b> <a href="string__mod_8F90_source.html#l00001">string_mod.F90:1</a></div></div>
<div class="ttc" id="findpts__test_8c_html_a829c8709c057c78bfc9f0943922e1ba9"><div class="ttname"><a href="findpts__test_8c.html#a829c8709c057c78bfc9f0943922e1ba9">np</a></div><div class="ttdeci">static uint np</div><div class="ttdef"><b>Definition:</b> <a href="findpts__test_8c_source.html#l00063">findpts_test.c:63</a></div></div>
<div class="ttc" id="navier8_8F90_html_aaeec4769efda346366e7e561aa844c88"><div class="ttname"><a href="navier8_8F90.html#aaeec4769efda346366e7e561aa844c88">get_local_crs_galerkin</a></div><div class="ttdeci">subroutine get_local_crs_galerkin(a, ncl, nxc, h1, h2, w1, w2)</div><div class="ttdoc">This routine generates Nelv submatrices of order ncl using Galerkin projection. </div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00407">navier8.F90:407</a></div></div>
<div class="ttc" id="classstring_html_a788cdffdfd5841a6e4117c4b8e80da77"><div class="ttname"><a href="classstring.html#a788cdffdfd5841a6e4117c4b8e80da77">string::ltrunc</a></div><div class="ttdeci">integer function ltrunc(string, l)</div><div class="ttdef"><b>Definition:</b> <a href="string__mod_8F90_source.html#l00260">string_mod.F90:260</a></div></div>
<div class="ttc" id="connect1_8F90_html_a1c96db1fac78d436aaab41482ed01aca"><div class="ttname"><a href="connect1_8F90.html#a1c96db1fac78d436aaab41482ed01aca">facev</a></div><div class="ttdeci">subroutine facev(a, ie, iface, val, nx, ny, nz)</div><div class="ttdoc">Assign the value VAL to face(IFACE,IE) of array A. IFACE is the input in the pre-processor ordering s...</div><div class="ttdef"><b>Definition:</b> <a href="connect1_8F90_source.html#l01041">connect1.F90:1041</a></div></div>
<div class="ttc" id="navier8_8F90_html_aae4a347bc7ce7b06fa7abf792db70953"><div class="ttname"><a href="navier8_8F90.html#aae4a347bc7ce7b06fa7abf792db70953">gen_crs_basis</a></div><div class="ttdeci">subroutine gen_crs_basis(b, j)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00449">navier8.F90:449</a></div></div>
<div class="ttc" id="comm__mpi_8F90_html_a59fcf8a02fe54ab37f61050e3ca6b197"><div class="ttname"><a href="comm__mpi_8F90.html#a59fcf8a02fe54ab37f61050e3ca6b197">exitti</a></div><div class="ttdeci">subroutine exitti(stringi, idata)</div><div class="ttdef"><b>Definition:</b> <a href="comm__mpi_8F90_source.html#l00328">comm_mpi.F90:328</a></div></div>
<div class="ttc" id="navier8_8F90_html_aba4affb4dc377d9eae7e5f3fed44130c"><div class="ttname"><a href="navier8_8F90.html#aba4affb4dc377d9eae7e5f3fed44130c">iftuple_ianeb</a></div><div class="ttdeci">logical function iftuple_ianeb(a, b, key, nkey)</div><div class="ttdef"><b>Definition:</b> <a href="navier8_8F90_source.html#l00290">navier8.F90:290</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 14 2015 10:52:58 for Nek5000 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
