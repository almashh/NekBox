<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Nek5000: Gather Scatter Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nek5000
   </div>
   <div id="projectbrief">SEM for Incompressible NS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Gather Scatter Library</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:gs_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gs_8c.html">gs.c</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Gather/Scatter Library</p>
<p>The code</p>
<p>struct comm c; // see "comm.h" slong id[n]; // the slong type is defined in "types.h" ... struct <a class="el" href="structgs__data.html">gs_data</a> *g = <a class="el" href="gs_8h.html#ab06a9ecd097f6fcc2fff32089bc1451b">gs_setup(id,n, &amp;c, 0,gs_auto,1)</a>;</p>
<p>defines a partition of the set of (processor, local index) pairs, (p,i)  S_j iff abs(id[i]) == j on processor p That is, all (p,i) pairs are grouped together (in group S_j) that have the same id (=j). S_0 is treated specially &mdash; it is ignored completely (i.e., when id[i] == 0, local index i does not participate in any gather/scatter operation If id[i] on proc p is negative then the pair (p,i) is "flagged". This determines the non-symmetric behavior. For the simpler, symmetric case, all id's should be positive.</p>
<p>The second to last argument to gs_setup is the method to use, one of gs_pairwise, gs_crystal_router, gs_all_reduce, gs_auto The method "gs_auto" tries ~10 runs of each and chooses the fastest. For a single-use handle, it makes more sense to use "gs_crystal_router".</p>
<p>When "g" is no longer needed, free it with</p>
<p><a class="el" href="gs_8h.html#a441b940f4ce8080f2158041ffd04d72a">gs_free(g)</a>;</p>
<p>A basic gather/scatter operation is, e.g.,</p>
<p>double v[n]; buffer buf; // see "mem.h" for "buffer" ... <a class="el" href="gs_8h.html#acdc92e1d8e990f63f7c51d5d9e9d0a05">gs(v, gs_double,gs_add, 0, g,&amp;buf)</a>;</p>
<p>The buffer pointer can be null, in which case, a static buffer is used, shared across all gs handles. This gs call has the effect, (in the simple, symmetric, unflagged case)</p>
<p>v[i] &lt;&ndash; { (p,j)  S_{id[i]} } v_(p) [j]</p>
<p>where v_(p) [j] means v[j] on proc p. In other words, every v[i] is replaced by the sum of all v[j]'s with the same id, given by id[i]. This accomplishes "direct stiffness summation" corresponding to the action of QQ^T, where "Q" is a boolean matrix that copies from a global vector (indexed by id) to the local vectors indexed by (p,i) pairs.</p>
<p>Summation on doubles is not the only operation and datatype supported. The full list is defined in "gs_defs.h", and includes the operations gs_add, gs_mul, gs_max, gs_min and datatypes gs_double, gs_float, gs_int, gs_long, gs_sint, gs_slong. (The int and long types are the plain C types, whereas sint and slong are defined in "types.h").</p>
<p>For the nonsymmetric behavior, the "transpose" parameter is important:</p>
<p><a class="el" href="gs_8h.html#acdc92e1d8e990f63f7c51d5d9e9d0a05">gs(v, gs_double,gs_add, transpose, g,&amp;buf)</a>;</p>
<p>When transpose == 0, any "flagged" (p,i) pairs (id[i] negative on p) do not participate in the sum, but <em>do</em> still receive the sum on output. As a special case, when only one (p,i) pair is unflagged per group this corresponds to the rectangular "Q" matrix referred to above.</p>
<p>When transpose == 1, the "flagged" (p,i) pairs <em>do</em> participate in the sum, but do <em>not</em> get set on output. In the special case of only one unflagged (p,i) pair, this corresponds to the transpose of "Q" referred to above.</p>
<p>A version for vectors (contiguously packed) is, e.g.,</p>
<p>double v[n][k]; <a class="el" href="gs_8h.html#a3bd656c77aead1c82bb0a7f8538a1877">gs_vec(v,k, gs_double,gs_add, transpose, g,&amp;buf)</a>;</p>
<p>which is like "gs" operating on the datatype double[k], with summation here being vector summation. Number of messages sent is independent of k.</p>
<p>For combining the communication for "gs" on multiple arrays:</p>
<p>double v1[n], v2[n], ..., vk[n]; double (*vs)[k] = {v1, v2, ..., vk};</p>
<p><a class="el" href="gs_8h.html#ae6d75a2f33c7c37df91b383c6c22513a">gs_many(vs,k, gs_double,op, t, g,&amp;buf)</a>;</p>
<p>This call is equivalent to</p>
<p><a class="el" href="gs_8h.html#acdc92e1d8e990f63f7c51d5d9e9d0a05">gs(v1, gs_double,op, t, g, &amp;buf)</a>; <a class="el" href="gs_8h.html#acdc92e1d8e990f63f7c51d5d9e9d0a05">gs(v2, gs_double,op, t, g, &amp;buf)</a>; ... <a class="el" href="gs_8h.html#acdc92e1d8e990f63f7c51d5d9e9d0a05">gs(vk, gs_double,op, t, g, &amp;buf)</a>;</p>
<p>except that all communication is done together.</p>
<p>Finally, gs_unique has the same basic signature as gs_setup:</p>
<p><a class="el" href="gs_8h.html#a3324ab61a2f5525731e56f1c71fbad61">gs_unique(id,n, &amp;c)</a>;</p>
<p>This call modifies id, "flagging" (by negating id[i]) all (p,i) pairs in each group except one. The sole "unflagged" member of the group is chosen in an arbitrary but consistent way. If the "unique" flag is set when calling gs_setup, the behavior is equivalent to first calling gs_unique, except that the id array is left unmodified. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 14 2015 10:53:00 for Nek5000 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
